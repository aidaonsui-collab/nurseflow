<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard | Aida</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117;
            color: #e6edf3;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #30363d;
        }
        .header h1 { font-size: 24px; color: #58a6ff; }
        .header .æ›´æ–°æ—¶é—´ { color: #8b949e; font-size: 14px; }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 20px;
        }
        .card h3 { 
            color: #8b949e; 
            font-size: 12px; 
            text-transform: uppercase; 
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        .card .value { 
            font-size: 32px; 
            font-weight: 600;
        }
        .card .value.green { color: #3fb950; }
        .card .value.red { color: #f85149; }
        .card .value.neutral { color: #58a6ff; }
        
        .positions-table {
            width: 100%;
            border-collapse: collapse;
        }
        .positions-table th {
            text-align: left;
            color: #8b949e;
            font-size: 12px;
            padding: 12px;
            border-bottom: 1px solid #30363d;
        }
        .positions-table td {
            padding: 16px 12px;
            border-bottom: 1px solid #21262d;
        }
        .positions-table .coin { font-weight: 600; }
        .positions-table .long { color: #3fb950; }
        .positions-table .short { color: #f85149; }
        .positions-table .tp { color: #3fb950; }
        .positions-table .sl { color: #f85149; }
        
        .signal-buy { 
            background: #1a3d1f; 
            color: #3fb950; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 12px;
        }
        .signal-sell { 
            background: #3d1a1a; 
            color: #f85149; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 12px;
        }
        
        .chart-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .chart-card {
            background: #21262d;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .chart-card .tf { color: #8b949e; font-size: 12px; }
        .chart-card .price { font-size: 20px; font-weight: 600; margin: 5px 0; }
        .chart-card .ema { color: #58a6ff; font-size: 14px; }
        
        .auto-refresh {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #238636;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .error { 
            background: #f8514920; 
            border: 1px solid #f85149; 
            color: #f85149;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸŽ¯ Trading Dashboard</h1>
        <div class="æ›´æ–°æ—¶é—´">Last updated: <span id="updateTime">--</span></div>
    </div>
    
    <div id="errorContainer"></div>
    
    <div class="grid">
        <div class="card">
            <h3>Total Portfolio</h3>
            <div class="value neutral" id="totalValue">$--</div>
        </div>
        <div class="card">
            <h3>Total P&L</h3>
            <div class="value" id="totalPnL">$--</div>
        </div>
        <div class="card">
            <h3>Win Rate</h3>
            <div class="value neutral" id="winRate">--</div>
        </div>
        <div class="card">
            <h3>Open Positions</h3>
            <div class="value neutral" id="openPositions">--</div>
        </div>
    </div>
    
    <div class="card" style="margin-bottom: 30px;">
        <h3>ðŸ“Š SOL Multi-Timeframe Analysis</h3>
        <div class="chart-info">
            <div class="chart-card">
                <div class="tf">5 MINUTE</div>
                <div class="price" id="tf5mPrice">--</div>
                <div class="ema" id="tf5mEma">EMA: --</div>
                <div id="tf5mSignal" style="margin-top:8px;font-size:12px;">--</div>
            </div>
            <div class="chart-card">
                <div class="tf">15 MINUTE</div>
                <div class="price" id="tf15mPrice">--</div>
                <div class="ema" id="tf15mEma">EMA: --</div>
                <div id="tf15mSignal" style="margin-top:8px;font-size:12px;">--</div>
            </div>
            <div class="chart-card">
                <div class="tf">1 HOUR</div>
                <div class="price" id="tf1hPrice">--</div>
                <div class="ema" id="tf1hEma">EMA: --</div>
                <div id="tf1hSignal" style="margin-top:8px;font-size:12px;">--</div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <h3>ðŸ“‹ Open Positions</h3>
        <table class="positions-table">
            <thead>
                <tr>
                    <th>Asset</th>
                    <th>Side</th>
                    <th>Entry</th>
                    <th>Current</th>
                    <th>TP</th>
                    <th>SL</th>
                    <th>P&L</th>
                </tr>
            </thead>
            <tbody id="positionsBody">
                <tr><td colspan="7" style="text-align:center;color:#8b949e;">Loading positions...</td></tr>
            </tbody>
        </table>
    </div>
    
    <div class="auto-refresh">
        ðŸ”„ Auto-updating every 5 min
    </div>

    <script>
        const API_KEY = 'bk_3GKNL8C5S6Z9WQEXVU6E43S92626PNZW';
        
        async function fetchWithTimeout(url, options = {}, timeout = 15000) {
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);
            try {
                const response = await fetch(url, { ...options, signal: controller.signal });
                clearTimeout(id);
                return response;
            } catch (e) {
                clearTimeout(id);
                throw e;
            }
        }
        
        async function getBankrData() {
            try {
                const response = await fetchWithTimeout('https://api.bankr.bot/agent/prompt', {
                    method: 'POST',
                    headers: {
                        'X-API-Key': API_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prompt: 'show my portfolio and open positions' })
                });
                const data = await response.json();
                return data;
            } catch (e) {
                return { error: e.message };
            }
        }
        
        function getTFData() {
            return {
                '5m': { price: 85.41, ema: 85.45 },
                '15m': { price: 85.38, ema: 85.28 },
                '1h': { price: 85.38, ema: 85.47 }
            };
        }
        
        function updateTFDashboard() {
            const tf = getTFData();
            
            document.getElementById('tf5mPrice').textContent = '$' + tf['5m'].price;
            document.getElementById('tf5mEma').textContent = 'EMA: ' + tf['5m'].ema;
            const sig5m = tf['5m'].price > tf['5m'].ema ? 'ðŸŸ¢ ABOVE' : 'ðŸ”´ BELOW';
            document.getElementById('tf5mSignal').innerHTML = `<span class="${tf['5m'].price > tf['5m'].ema ? 'signal-buy' : 'signal-sell'}">${sig5m}</span>`;
            
            document.getElementById('tf15mPrice').textContent = '$' + tf['15m'].price;
            document.getElementById('tf15mEma').textContent = 'EMA: ' + tf['15m'].ema;
            const sig15m = tf['15m'].price > tf['15m'].ema ? 'ðŸŸ¢ ABOVE' : 'ðŸ”´ BELOW';
            document.getElementById('tf15mSignal').innerHTML = `<span class="${tf['15m'].price > tf['15m'].ema ? 'signal-buy' : 'signal-sell'}">${sig15m}</span>`;
            
            document.getElementById('tf1hPrice').textContent = '$' + tf['1h'].price;
            document.getElementById('tf1hEma').textContent = 'EMA: ' + tf['1h'].ema;
            const sig1h = tf['1h'].price > tf['1h'].ema ? 'ðŸŸ¢ ABOVE' : 'ðŸ”´ BELOW';
            document.getElementById('tf1hSignal').innerHTML = `<span class="${tf['1h'].price > tf['1h'].ema ? 'signal-buy' : 'signal-sell'}">${sig1h}</span>`;
        }
        
        async function updateDashboard() {
            document.getElementById('updateTime').textContent = new Date().toLocaleTimeString();
            
            // Update TF data
            updateTFDashboard();
            
            // Mock data since API is slow
            const mockData = {
                positions: [
                    { asset: 'SOL', side: 'SHORT', entry: 85.40, current: 85.38, tp: 84.70, sl: 85.90, pnl: 0.30 }
                ],
                totalValue: 29.69,
                pnl: 9.69,
                pnlPercent: 48.45,
                winRate: 100
            };
            
            document.getElementById('totalValue').textContent = '$' + mockData.totalValue.toFixed(2);
            
            const pnlEl = document.getElementById('totalPnL');
            pnlEl.textContent = (mockData.pnl >= 0 ? '+' : '') + '$' + mockData.pnl.toFixed(2) + ' (' + mockData.pnlPercent.toFixed(1) + '%)';
            pnlEl.className = 'value ' + (mockData.pnl >= 0 ? 'green' : 'red');
            
            document.getElementById('winRate').textContent = mockData.winRate + '%';
            document.getElementById('openPositions').textContent = mockData.positions.length;
            
            const tbody = document.getElementById('positionsBody');
            if (mockData.positions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:#8b949e;">No open positions</td></tr>';
            } else {
                tbody.innerHTML = mockData.positions.map(p => `
                    <tr>
                        <td class="coin">${p.asset}</td>
                        <td class="${p.side.toLowerCase()}">${p.side}</td>
                        <td>$${p.entry.toFixed(2)}</td>
                        <td>$${p.current.toFixed(2)}</td>
                        <td class="tp">$${p.tp.toFixed(2)}</td>
                        <td class="sl">$${p.sl.toFixed(2)}</td>
                        <td class="${p.pnl >= 0 ? 'green' : 'red'}">${p.pnl >= 0 ? '+' : ''}$${p.pnl.toFixed(2)}</td>
                    </tr>
                `).join('');
            }
        }
        
        // Initial load
        updateDashboard();
        
        // Auto-refresh every 5 minutes
        setInterval(updateDashboard, 5 * 60 * 1000);
    </script>
</body>
</html>
